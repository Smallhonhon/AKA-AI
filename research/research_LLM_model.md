

# LLMのモデルの違いによる回答の応答スピードと内容の違い
gptモデルの違いによる回答の応答スピードと回答内容を比較するため、Difyを使ってチャットボットを作り、デバッグとプレビューで実験した結果です。
Azureだとモデルを変更してデバッグするのは手間がかかるのですが、Difyだと下記の動画にあるように簡単にできます。
Difyの環境は、PCにDocker Composeでデプロイしています。
事例の26ファイルがナレッジとしてアップロードし、バイブリッド検索のリランクモデルはcohereのrerank-multilingual-v3.0を利用、top-kは３です。<br>

実験に利用したプロンプトは下記です。

|No.|プロンプト|
|:--|:------|
|2|SharePoint Onlineの検索の事例を探してください|

26ファイルの中で、SharePoint Onlineが出てくる事例は２つです。
<br>
<br>
## 1. 最大チャンク長512、オーバーラップ128のチャンク設定の場合
### 1-1. 結果まとめ
gpt-4oはプロンプトで箇条書きを指示しなくても項目を分けた回答を作りました。<br>
簡潔な回答内容でもよければ、速度や料金から考えるとgpt-4o-miniを選択することも考えられそうです。

|モデル|gpt-4o|gpt-4o-mini|gpt-4|gpt-3.5-turbo|
|:----:|:-----:|:----------:|:----:|:------------:|
|時間|~6秒|~5秒|〜8秒|~4秒|
|回答内容|2社記載<br>詳細に回答|2社記載<br>簡潔に回答|2社記載<br>簡潔に回答|1社記載<br>簡潔に回答|

### 1-2. 実験した時の動画
8秒以内で終わるので、0.5倍速で再生すると見やすいです。<br>

https://github.com/user-attachments/assets/2a60af8b-4480-4971-b37e-439c8d58a5c5

### 1-3. 回答内容の詳細
各モデルの回答内容を掲載します。

|gpt-4oの回答|
|:-----------|
|大和ハウス工業株式会社と株式会社トインクスの事例があります。<br>1. **大和ハウス工業株式会社**<br>   - **目的**: SharePoint Online上に構築された社内ポータルサイトの検索性向上。<br>   - **導入ツール**: Neuron Enterprise Search。<br>   - **効果**: 営業職・技術職・事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現。クラウドストレージへの移行に伴いデータの所在が分散したが、検索システムによってそれを意識することなく欲しい情報に辿り着けるようになった。<br><br>2. **株式会社トインクス**<br>   - **目的**: ファイルサーバのリプレイスをきっかけに企業内検索システムを導入。<br>   - **導入ツール**: Neuron Enterprise Search。<br>   - **効果**: ファイルサーバだけでなく、SharePoint Online上のファイルやポータルサイトの情報を素早く見つけ出せるようになり、業務効率化が促進された。<br>これらの事例は、SharePoint Onlineの検索性向上に成功した具体例として参考になります。<br>出典元ファイルのURL: [出典元ファイル](#)||

|gpt-4o-miniの回答|
|:-----------|
|SharePoint Onlineの検索に関する導入事例として、大和ハウス工業株式会社のケースがあります。彼らは「Neuron Enterprise Search」を導入し、社内ポータルサイトの検索性を向上させました。このシステムにより、営業職・技術職・事務職など、さまざまな部門でシームレスな検索体験を実現しています。<br>また、株式会社トインクスもファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化を促進しました。<br>具体的なURLは提供できませんが、これらの事例を参考にしてみてください。|

|gpt-4の回答|
|:-----------|
|大和ハウス工業株式会社では、SharePoint Online上に構築された社内ポータルサイトの検索性向上を目的に「Neuron Enterprise Search」を導入しました。これにより、営業職、技術職、事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現しています。<br>また、株式会社トインクスでは、ファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化が促進されました。|

|gpt-3.5-turboの回答|
|:-----------|
|SharePoint Onlineの検索の事例として、Neuron ESを導入した大和ハウス工業株式会社の事例があります。Neuron ESはSharePoint Online上に構築された社内ポータルサイトの検索性向上を目的に導入され、営業職・技術職・事務職など部門や職種を問わず、幅広い業務におけるシームレスな検索体験を実現しています。詳細は以下のURLから参照できます。<br>[Neuron ES導入事例 - 大和ハウス工業株式会社](URL)|

<br>
<br>

## 2. 追試
### 2-1. 最大チャンク長2000、オーバーラップ500のチャンク設定の場合
結果に大きな違いはありませんでした。<br>
gpt-4oの回答内容が箇条書きにならなかったですが、プロンプトで箇条書きを指示すれば箇条書きになります。<br>
<br>

### 2-2. プロンプトに指示を追加した場合
プロンプトに指示を追加した時の回答内容を確認しました。チャンク設定は、最大チャンク長512、オーバーラップ128としています。

|プロンプト|
|:-------|
|SharePoint Onlineの検索の事例を探してください。回答には目的と効果を入れてください。|

#### 2-2-1. 結果まとめ
プロンプトに対する回答内容としては、gpt-4oが詳細に回答しています。
|モデル|gpt-4o|gpt-4o-mini|gpt-4|gpt-3.5-turbo|
|:----:|:-----:|:----------:|:----:|:------------:|
|回答内容|2社記載<br>詳細に回答|2社記載<br>簡潔に回答|社名記載無し<br>簡潔に回答|回答できず|

#### 2-2-2. 回答詳細
|gpt-4oの回答|
|:-----------|
|以下は、SharePoint Onlineの検索に関する導入事例です。<br>**事例1: 大和ハウス工業株式会社**<br>**目的:**<br>クラウドストレージ（SharePoint Online）への移行に伴い、データの所在が分散したため、検索システムによってそれを意識することなく欲しい情報に辿り着けるようにすること。<br>**効果:**<br>- 検索ストレスが低減し、業務効率が向上。<br>- 自社システムとのAPI連携により、従業員に新たな利用価値を創出。<br><br>**事例2: 株式会社トインクス**<br>**目的:**<br>ファイルサーバのリプレイスをきっかけに企業内検索システムを導入し、SharePoint Onlineとの横断検索によって業務効率化を促進すること。<br>**効果:**<br>- ファイルサーバだけでなく、SharePoint Online上のファイルやポータルサイトの情報を素早く見つけ出せるようになった。<br>- 利便性が高いツールであることから、自社利用だけではなく、グループ企業や他の企業への展開（販売）にも期待が持てる。<br>これらの事例は、SharePoint Onlineの検索機能を強化するために「Neuron ES」を導入し、業務効率化や情報共有の向上に成功した例です。|

|gpt-4o-miniの回答|
|:-----------|
|大和ハウス工業株式会社の事例があります。<br>**目的**: SharePoint Onlineの検索性を向上させるために、Neuron ESを導入しました。特に技術文書の検索に重きを置き、業務効率を改善することを目指しました。<br>**効果**: Neuron ESの導入により、検索ストレスが低減し、業務効率が向上しました。従業員はファイルサーバやSharePoint Online上の情報を素早く見つけ出せるようになり、全社で幅広く利用されるようになりました。また、自社システムとのAPI連携により、新たな利用価値も創出されました。<br>この事例は、全社的な「情報共有・連携」を密にするための取り組みの一環として行われました。|

|gpt-4の回答|
|:-----------|
|SharePoint Onlineの検索性向上のために「Neuron Enterprise Search」が導入された事例があります。この導入の目的は、社内ポータルサイト上での検索性を向上させることで、部門や職種を問わず幅広い業務においてシームレスな検索体験を実現することです。その効果としては、全社的な情報共有・連携を密にし、社内の情報伝達の強化やナレッジ共有を目的とした再編成を進めることが挙げられます。|

|gpt-3.5-turboの回答|
|:-----------|
|申し訳ありませんが、その情報は提供できません。他にお手伝いできることがあればお知らせください。|

### 2-3.番外編：PDFの文字化けについて
Difyでナレッジとして追加できるファイル形式は、TXT, MARKDOWN, MDX, PDF, HTML, XLSX, XLS, DOCX, CSV, MD, HTMとなっており、pptxを追加できません。pdfをナレッジにする場合、Difyはpdfの操作や解析をPythonのライブラリであるpypdfium2で行います。pypdfium2は、Googleが提供するPDFiumライブラリに基づいています。今回の実験を通して、pypdfium2を使う場合、pdfファイルの日本語が文字化けすることがあります。文字化けする例の画像を添付します。例えば、「SharePoint Online」が「㻿hare㻼oint 㻻nline」となっています。
<br>
<img width="1000" alt="スクリーンショット 2025-03-21 21 53 35" src="https://github.com/user-attachments/assets/79905447-5950-4a18-9c1d-97421ae141c3" />
<br>
「㻿hare㻼oint 㻻nline」を例にすると、いくつか試したところでは、「SharePoint Online」で検索ができるものの、検索した時のスコアは著しく低下し、回答精度にも影響が出るようです。PowerPointからpdfファイルを出力した場合にはpypdfium2で処理しても文字化しないことを確認しており、本実験のDifyで使ったファイルは文字化けはしていません。<br>
Difyで文字化けするpdfファイルは、Azure AI Searchでは文字化けしていませんでした。また、同じファイルをApache PDFBoxでテキスト抽出したところ、文字化けはしませんでした。<br>
この現象は、ChromiumにIssueとして報告しています。ChromiumはGoogleが主導するオープンソースのウェブブラウザプロジェクトであり、Google Chromeの基盤となっています。<br>
AIの時代にはpdfの作り方やpdfを扱うライブラリにも配慮が必要になりそうです。詳しい報告は、別の機会にしたいと思います。
